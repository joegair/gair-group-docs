<!-- 3Dmol.js dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.0/3Dmol-min.js"></script>

<!-- Molecule viewer container -->
<div class="molecule-viewer" style="width: 100%; height: 400px; position: relative;">
    <div id="molecule-{{ include.id }}" style="width: 100%; height: 100%;"></div>
    <div id="molecule-error-{{ include.id }}" style="display: none; color: red; text-align: center; padding: 20px;">
        Error loading molecule viewer. Please try refreshing the page.
    </div>
</div>

<script>
    $(document).ready(function() {
        try {
            var viewer = $3Dmol.createViewer("molecule-{{ include.id }}", {
                backgroundColor: 'white'
            });
            
            // Load the molecule
            $.get("{{ include.pdb }}", function(data) {
                viewer.addModel(data, "pdb");
                viewer.setStyle({}, {stick:{radius:0.15}, sphere:{scale:0.3}});
                viewer.zoomTo();
                viewer.render();
            }).fail(function() {
                $("#molecule-error-{{ include.id }}").show();
                $("#molecule-{{ include.id }}").hide();
            });
        } catch (error) {
            $("#molecule-error-{{ include.id }}").show();
            $("#molecule-{{ include.id }}").hide();
            console.error("Error initializing molecule viewer:", error);
        }
    });
</script> 